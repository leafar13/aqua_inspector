### Acueductos API - HTTP Client Tests
### Base URL: http://localhost:8081
### 
### Variables globales
@baseUrl = http://localhost:8081
@contentType = application/json

###############################################################################
### AUTH ENDPOINTS
###############################################################################

### 1. Registrar nuevo usuario
POST {{baseUrl}}/api/auth/register
Content-Type: {{contentType}}

{
  "fullName": "Juan Pérez",
  "email": "juan.perez@acueductos.com",
  "username": "jperez",
  "password": "password123",
  "organizationId": 1,
  "roleId": 2
}

### 2. Login
POST {{baseUrl}}/api/auth/login
Content-Type: {{contentType}}

{
  "username": "jperez",
  "password": "satelite"
}

> {%
  client.global.set("authToken", response.body.token);
%}

###############################################################################
### SAMPLE ENDPOINTS (Muestras de Agua)
###############################################################################

### 3. Crear muestra online (sin fecha personalizada)
POST {{baseUrl}}/api/samples
Content-Type: {{contentType}}
#Authorization: Bearer {{authToken}}

{
  "sampleRequest": {
    "waterAssociationId": 2,
    "systemId": 2,
    "samplingUserId": 1,
    "samplingDatetime": "2025-07-07T10:30:00",
    "gpsLatitude": 4.6097102,
    "gpsLongitude": -74.0817500,
    "locationName": "Tanque principal - Sector Norte",
    "observations": "Muestra tomada en condiciones normales de operación",
    "synchronizedFlag": false
  },
  "waterParameterRequest": {
    "temperature": 18.5,
    "ph": 7.2,
    "parameterObservations": "Valores dentro del rango normal"
  }
}

### 4. Crear muestra offline sincronizada (preservando fecha original)
POST {{baseUrl}}/api/samples
Content-Type: {{contentType}}
# Authorization: Bearer {{authToken}}

{
  "sampleRequest": {
    "waterAssociationId": 2,
    "systemId": 2,
    "samplingUserId": 1,
    "samplingDatetime": "2025-07-07T14:15:00",
    "gpsLatitude": 4.6150000,
    "gpsLongitude": -74.0900000,
    "locationName": "Pozo artesiano - Vereda",
    "observations": "Muestra creada offline, sincronizada posteriormente. CreatedDate será 2024-03-10T14:15:00",
    "synchronizedFlag": true
  },
  "waterParameterRequest": {
    "temperature": 22.1,
    "ph": 6.8,
    "parameterObservations": "Temperatura ligeramente elevada, pH dentro del rango"
  }
}

### 5. Crear múltiples muestras (Batch)
POST {{baseUrl}}/api/samples/batch
Content-Type: {{contentType}}
# Authorization: Bearer {{authToken}}

{
  "samples": [
    {
      "sampleRequest": {
        "waterAssociationId": 3,
        "systemId": 1,
        "samplingUserId": 1,
        "samplingDatetime": "2025-07-07T08:00:00",
        "gpsLatitude": 4.6120000,
        "gpsLongitude": -74.0850000,
        "locationName": "Tanque del arbol",
        "observations": "Primera muestra del día",
        "synchronizedFlag": true
      },
      "waterParameterRequest": {
        "temperature": 19.2,
        "ph": 7.1,
        "parameterObservations": "Condiciones estables"
      }
    },
    {
      "sampleRequest": {
        "waterAssociationId": 3,
        "systemId": 1,
        "samplingUserId": 1,
        "samplingDatetime": "2025-07-07T08:00:00",
        "gpsLatitude": 4.6120000,
        "gpsLongitude": -74.0850000,
        "locationName": "Tanque secundario",
        "observations": "Muestra de tarde para comparación",
        "synchronizedFlag": true
      },
      "waterParameterRequest": {
        "temperature": 21.8,
        "ph": 7.0,
        "parameterObservations": "Ligero aumento de temperatura por exposición solar"
      }
    }
  ]
}

### 6. Obtener muestra por ID
GET {{baseUrl}}/api/samples/1
Authorization: Bearer {{authToken}}

### 7. Obtener todas las muestras
GET {{baseUrl}}/api/samples
Authorization: Bearer {{authToken}}

### 8. Obtener muestras por usuario
GET {{baseUrl}}/api/samples/user/1
Authorization: Bearer {{authToken}}

### 9. Obtener muestras por asociación
GET {{baseUrl}}/api/samples/association/1
Authorization: Bearer {{authToken}}

### 10. Obtener resumen de muestras por usuario y rango de fechas (NUEVO)
GET {{baseUrl}}/api/samples/summary/user/1?startDate=01/03/2024&endDate=31/03/2024
Authorization: Bearer {{authToken}}

### 11. Eliminar muestra
DELETE {{baseUrl}}/api/samples/1
Authorization: Bearer {{authToken}}

###############################################################################
### USER ENDPOINTS
###############################################################################

### 12. Obtener todos los usuarios
GET {{baseUrl}}/api/users
Authorization: Bearer {{authToken}}

### 13. Obtener usuario por ID
GET {{baseUrl}}/api/users/1
Authorization: Bearer {{authToken}}

### 14. Crear nuevo usuario
POST {{baseUrl}}/api/users
Content-Type: {{contentType}}
Authorization: Bearer {{authToken}}

{
  "fullName": "María García",
  "email": "maria.garcia@acueductos.com",
  "username": "mgarcia",
  "passwordHash": "hashedPassword123",
  "organizationId": 1,
  "roleId": 3,
  "active": true
}

### 15. Actualizar usuario
PUT {{baseUrl}}/api/users/1
Content-Type: {{contentType}}
Authorization: Bearer {{authToken}}

{
  "fullName": "María García Rodríguez",
  "email": "maria.garcia@acueductos.com",
  "username": "mgarcia",
  "passwordHash": "hashedPassword123",
  "organizationId": 1,
  "roleId": 3,
  "active": true
}

### 16. Eliminar usuario
DELETE {{baseUrl}}/api/users/1
Authorization: Bearer {{authToken}}

### 17. Búsqueda de usuarios
GET {{baseUrl}}/api/users/lookup?query=maria
Authorization: Bearer {{authToken}}

###############################################################################
### ORGANIZATION ENDPOINTS
###############################################################################

### 18. Obtener todas las organizaciones
GET {{baseUrl}}/api/organizations
Authorization: Bearer {{authToken}}

### 19. Obtener organización por ID
GET {{baseUrl}}/api/organizations/1
Authorization: Bearer {{authToken}}

### 20. Crear nueva organización
POST {{baseUrl}}/api/organizations
Content-Type: {{contentType}}
Authorization: Bearer {{authToken}}

{
  "name": "Acueducto Municipal de Ejemplo",
  "active": true
}

### 21. Actualizar organización
PUT {{baseUrl}}/api/organizations/1
Content-Type: {{contentType}}
Authorization: Bearer {{authToken}}

{
  "name": "Acueducto Municipal de Ejemplo Actualizado",
  "active": true
}

### 22. Eliminar organización
DELETE {{baseUrl}}/api/organizations/1
Authorization: Bearer {{authToken}}

###############################################################################
### WATER ASSOCIATION ENDPOINTS
###############################################################################

### 23. Obtener todas las asociaciones de agua
GET {{baseUrl}}/api/water-associations
Authorization: Bearer {{authToken}}

### 24. Obtener asociación por ID
GET {{baseUrl}}/api/water-associations/1
Authorization: Bearer {{authToken}}

### 25. Crear nueva asociación de agua
POST {{baseUrl}}/api/water-associations
Content-Type: {{contentType}}
Authorization: Bearer {{authToken}}

{
  "organizationId": 1,
  "name": "Asociación de Agua Vereda El Carmen",
  "active": true
}

### 26. Actualizar asociación de agua
PUT {{baseUrl}}/api/water-associations/1
Content-Type: {{contentType}}
Authorization: Bearer {{authToken}}

{
  "organizationId": 1,
  "name": "Asociación de Agua Vereda El Carmen Actualizada",
  "active": true
}

### 27. Eliminar asociación de agua
DELETE {{baseUrl}}/api/water-associations/1
Authorization: Bearer {{authToken}}

###############################################################################
### SYSTEM ENDPOINTS
###############################################################################

### 28. Obtener todos los sistemas
GET {{baseUrl}}/api/systems
Authorization: Bearer {{authToken}}

### 29. Obtener sistema por ID
GET {{baseUrl}}/api/systems/1
Authorization: Bearer {{authToken}}

### 30. Crear nuevo sistema
POST {{baseUrl}}/api/systems
Content-Type: {{contentType}}
Authorization: Bearer {{authToken}}

{
  "waterAssociationId": 1,
  "systemName": "Sistema Principal de Distribución",
  "systemNumber": 1,
  "active": true
}

### 31. Actualizar sistema
PUT {{baseUrl}}/api/systems/1
Content-Type: {{contentType}}
Authorization: Bearer {{authToken}}

{
  "waterAssociationId": 1,
  "systemName": "Sistema Principal de Distribución Actualizado",
  "systemNumber": 1,
  "active": true
}

### 32. Eliminar sistema
DELETE {{baseUrl}}/api/systems/1
Authorization: Bearer {{authToken}}

###############################################################################
### ROLE ENDPOINTS
###############################################################################

### 33. Obtener todos los roles
GET {{baseUrl}}/api/roles
Authorization: Bearer {{authToken}}

### 34. Obtener rol por ID
GET {{baseUrl}}/api/roles/1
Authorization: Bearer {{authToken}}

### 35. Crear nuevo rol
POST {{baseUrl}}/api/roles
Content-Type: {{contentType}}
Authorization: Bearer {{authToken}}

{
  "name": "Técnico de Campo",
  "active": true
}

### 36. Actualizar rol
PUT {{baseUrl}}/api/roles/1
Content-Type: {{contentType}}
Authorization: Bearer {{authToken}}

{
  "name": "Técnico de Campo Senior",
  "active": true
}

### 37. Eliminar rol
DELETE {{baseUrl}}/api/roles/1
Authorization: Bearer {{authToken}}